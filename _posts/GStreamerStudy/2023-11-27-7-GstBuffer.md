---
layout: post
title: 七、GstBuffer
categories: GStreamer核心对象
tags: [GStreamer]
---

```c

/**
 * GstBufferFlags:
 * @GST_BUFFER_FLAG_LIVE: 缓冲区包含实时数据，在 PAUSED 状态时应该被丢弃。
 * @GST_BUFFER_FLAG_DECODE_ONLY: 缓冲区包含应该被丢弃的数据，因为它将会被剪辑到段边界，
 *                               或者因为它不包含应该向用户显示的数据。
 * @GST_BUFFER_FLAG_DISCONT: 缓冲区标记了流中的数据不连续性。这通常发生在寻找操作后，
 *                           或从实时或网络源丢弃缓冲区后。
 * @GST_BUFFER_FLAG_RESYNC: 缓冲区的时间戳可能有不连续性，这个缓冲区是重新同步的好时机。
 * @GST_BUFFER_FLAG_CORRUPTED: 缓冲区数据已损坏。
 * @GST_BUFFER_FLAG_MARKER: 缓冲区包含特定于媒体的标记。对于视频，这是帧边界的结束，
 *                           对于音频，这是说话开始的标志。对于 RTP 数据包，这与
 *                           RTP 数据包头中的标记标志相匹配。
 * @GST_BUFFER_FLAG_HEADER: 缓冲区包含解码后续数据所需的头信息。
 * @GST_BUFFER_FLAG_GAP: 缓冲区被创建用于填补流中的间隙，并包含媒体中立数据
 *                       （元素可以切换到优化的代码路径，忽略缓冲区内容）。
 * @GST_BUFFER_FLAG_DROPPABLE: 缓冲区可以被丢弃而不破坏流，例如为了减少带宽。
 * @GST_BUFFER_FLAG_DELTA_UNIT: 此单元不能独立解码。
 * @GST_BUFFER_FLAG_TAG_MEMORY: 当缓冲区的内存被添加/移除时设置此标志。
 * @GST_BUFFER_FLAG_LAST: 可以从此标志开始添加额外的特定于媒体的标志。
 *
 * 用于描述 #GstBuffer 属性的一组缓冲区标志。
 */
typedef enum {
  GST_BUFFER_FLAG_LIVE          = (GST_MINI_OBJECT_FLAG_LAST << 0),
  GST_BUFFER_FLAG_DECODE_ONLY   = (GST_MINI_OBJECT_FLAG_LAST << 1),
  GST_BUFFER_FLAG_DISCONT       = (GST_MINI_OBJECT_FLAG_LAST << 2),
  GST_BUFFER_FLAG_RESYNC        = (GST_MINI_OBJECT_FLAG_LAST << 3),
  GST_BUFFER_FLAG_CORRUPTED     = (GST_MINI_OBJECT_FLAG_LAST << 4),
  GST_BUFFER_FLAG_MARKER        = (GST_MINI_OBJECT_FLAG_LAST << 5),
  GST_BUFFER_FLAG_HEADER        = (GST_MINI_OBJECT_FLAG_LAST << 6),
  GST_BUFFER_FLAG_GAP           = (GST_MINI_OBJECT_FLAG_LAST << 7),
  GST_BUFFER_FLAG_DROPPABLE     = (GST_MINI_OBJECT_FLAG_LAST << 8),
  GST_BUFFER_FLAG_DELTA_UNIT    = (GST_MINI_OBJECT_FLAG_LAST << 9),
  GST_BUFFER_FLAG_TAG_MEMORY    = (GST_MINI_OBJECT_FLAG_LAST << 10),
  /* 枚举值与上面标志对应 */
  
  /**
   * GST_BUFFER_FLAG_SYNC_AFTER:
   *
   * 写入磁盘或永久存储的元素应确保在写入此缓冲区的内容后同步数据。
   *
   * 自版本 1.6 起。
   */
  GST_BUFFER_FLAG_SYNC_AFTER    = (GST_MINI_OBJECT_FLAG_LAST << 11),

  /**
   * GST_BUFFER_FLAG_NON_DROPPABLE:
   *
   * 这个缓冲区很重要，不应该被丢弃。
   *
   * 这可以用来标记重要的缓冲区，例如标记携带关键帧或编解码器设置数据的 RTP 数据包，
   * 用于 RTP 前向错误纠正目的，或防止由于 QoS 而导致的静态视频帧被元素丢弃。
   *
   * 自版本 1.14 起。
   */
  GST_BUFFER_FLAG_NON_DROPPABLE = (GST_MINI_OBJECT_FLAG_LAST << 12),

  GST_BUFFER_FLAG_LAST          = (GST_MINI_OBJECT_FLAG_LAST << 16)
} GstBufferFlags;

```

```c
/**
 * GstBuffer:
 * @mini_object: 父结构
 * @pool: 指向缓冲区拥有者的池的指针
 * @pts: 缓冲区的展示时间戳，当 pts 未知或不相关时可以是 #GST_CLOCK_TIME_NONE。pts 包含媒体应该呈现给用户的时间戳。
 * @dts: 缓冲区的解码时间戳，当 dts 未知或不相关时可以是 #GST_CLOCK_TIME_NONE。dts 包含媒体应该被处理的时间戳。
 * @duration: 缓冲区数据的持续时间，当持续时间未知或不相关时可以是 #GST_CLOCK_TIME_NONE。
 * @offset: 缓冲区数据的特定于媒体的偏移量。
 *     对于视频帧，这是此缓冲区的帧号。
 *     对于音频样本，这是此缓冲区中第一个样本的偏移量。
 *     对于文件数据或压缩数据，这是此缓冲区中第一个字节的字节偏移量。
 * @offset_end: 此缓冲区中包含的最后一个偏移量。它的格式与 @offset 相同。
 *
 * #GstBuffer 的结构。使用相关的宏来访问公共变量。
 */

struct _GstBuffer {
  GstMiniObject          mini_object;

  /*< public >*/ /* with COW */
  GstBufferPool         *pool;

  /* timestamp */
  GstClockTime           pts;
  GstClockTime           dts;
  GstClockTime           duration;

  /* media specific offset */
  guint64                offset;
  guint64                offset_end;
};
```