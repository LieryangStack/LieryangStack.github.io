---
layout: post
title: 二十、STM32——FSMC
categories: STM32
tags: [STM32]
---

## 1 FSMC的概念及结构框图

### 1.1 FSMC概念

FSMC，Flexible Static Memory Controller，灵活的静态存储控制器。

用于驱动SRAM，NOR FLASH，NAND FLASH及PC卡类型的存储器。配置好FSMC，定义一个指向这些地址的指针，通过对指针操作就可以直接修改存储单元的内容，FSMC自动完成读写命令和数据访问操作，不需要程序去实现时序。也就是无需手动去拉高、拉低信号实现选择写、读和选择读写命令、数据等东西。

F1/ F4(407)系列大容量型号，且引脚数目在100脚以上的芯片都有FSMC接口。F4/F7/H7系列就是FMC接口，区别是FMC可以直接驱动SDRAM，FSMC不行。

### 1.1.1 FSMC（Flexible Static Memory Controller)

- FSMC主要用于控制静态存储器，如SRAM（Static Random Access Memory）等。不能扩展SDRAM。

- FSMC提供了与静态存储器进行接口通信的功能，包括读取和写入数据，控制地址线和数据线的操作等。

- FSMC通常用于需要快速访问速度和低延迟的应用场景，例如高性能嵌入式系统中。

### 1.1.2 FMC（Flexible Memory Controller）

- FMC则更加灵活，可以用于控制各种类型的存储器，包括SDRAM（Synchronous Dynamic Random Access Memory）、NOR Flash、NAND Flash等。

- FMC支持更多种类的存储器接口标准和协议，使其在连接各种存储器时更具通用性和灵活性。

- FMC通常用于需要较大存储容量或者对存储器种类要求较多样化的系统中。

## 2 FSMC接口

![alt text](image.png)

**所有的外部存储器共享这几种接口**：地址总线（FSMC_A[25:0]）、数据总线(FSMC_D[15:0])和控制信号(FSMC_NOE、FSMC_NWE、FSMC_NWAIT)。比如我同时有SRAM和NAND Flash，他们两个的地址、数据、控制信号GPIO口是连接到一起的。他们通过各自的片选接口，选择跟那个芯片通信。FMC将外部设备分为以下三类：

1. **NOR/PSRAM/SRAM/ROM/LCD**： 这类型设备使用相同的控制器。

2. **NAND Flash**：是一类设备。

3. **SDRAM**：是一类设备。TFTLCD可以当成SDRAM类型设备。

![alt text](image-1.png)

### 2.1 所有存储控制器公用引脚

- **FSMC_A[25:0]**：地址总线

- **FSMC_D[15:0]**：数据总线

- **FSMC_NOE**：读使能

- **FSMC_NWE**：写入使能

- **FSMC_NWAIT**：该引脚作用是同步外部存储器的等待信号，当外部存储器（如 SRAM 或 NOR Flash）响应较慢时，它可以通过 NWAIT 引脚向 STM32 发送等待信号，以延长 FSMC 访问周期，避免访问错误。

### 2.2 NOR/PSRAM/SRAM/ROM/LCD

- **FSMC_NE[4:1]** ：不同的NE脚是控制不同的地址的，当STM32访问某个地址的时候，对应的NE引脚会被自动控制设成低电平，此时由于一个NE引脚连接到一个SRAM的CE引脚，所以SRAM的片选被使能。<font color="red">连接的就是外设芯片的CS引脚</font>

- **FSMC_NL(or NADV)** ：对于 SRAM、NOR Flash 或 NAND Flash，此引脚通常不会用到。在 PC卡模式 下，FSMC_NL 作为 ADV#（地址有效信号），用于锁存地址信息。

- **FSMC_NBL[1:0]** ：FSMC_NBL0 控制低字节（D7-D0），FSMC_NBL1 控制高字节（D15-D8）。

- **FSMC_CLK** ：提供同步时钟信号，用于时序控制。

### 2.3 NAND/PC Card

这部分等使用的时候再补充

### 2.4 SDRAM

这部分等使用的时候再补充


## 3 