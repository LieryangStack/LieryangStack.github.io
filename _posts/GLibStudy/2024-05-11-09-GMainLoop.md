---
layout: post
title: 九、GLib——GMainLoop
categories: GLib学习笔记
tags: [GLib]
---

## 1 GMainLoop相关结构体

```c
/* filename: gmain.c */
struct _GMainLoop
{
  GMainContext *context;
  gboolean is_running; /* (atomic) */
  gint ref_count;  /* (atomic) */
};
```

**引用计数：**

```c
GMainLoop *loop = g_main_loop_new(NULL, TRUE); /* 引用计数加一，loop->ref_count = 1 */

 /* g_main_loop_run循环函数进入时候，引用计数加一， loop->ref_count = 2 
  * g_main_loop_run循环函数最后退出之前，引用计数减一， loop->ref_count = 1
  */
g_main_loop_run (loop); 、


/* 此时， loop->ref_count = 1 */

g_main_loop_unref (loop); /* 这里解引用loop的时候，会把context解引用一次，context里面会把source解引用一次 */
```

## 2 