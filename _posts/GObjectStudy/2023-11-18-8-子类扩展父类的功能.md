---
layout: post
title: 八、子类扩展父类的功能
categories: GObject学习笔记
tags: [GObject]
---

本节的示例是 TNumStr 对象。TNumStr 是 TStr 对象的子类。TNumStr 包含一个字符串及其类型，类型为 t_int、t_double 或 t_none。

- t_int：字符串表示一个整数

- t_double：字符串表示一个双精度（浮点）数

- t_none：字符串不表示上述两种数字

t_int 或 t_double 类型的字符串被称为数字字符串。这不是一个通用术语，仅在本教程中使用。简而言之，数字字符串是表示数字的字符串。例如，"0"、"-100" 和 "123.456" 都是数字字符串。它们是字符串，同时表示数字。

- "0" 是一个字符串。它是一个字符数组，其元素是 '0' 和 '\0'。它表示的是整数零。

- "-100" 是由 '-', '1', '0', '0' 和 '\0' 组成的字符串。它表示整数 -100。

- "123.456" 由 '1', '2', '3', '.', '4', '5', '6' 和 '\0' 组成。它表示实数（双精度类型）123.456。

数字字符串就是这样一种特定的字符串。

## 1 数字字符串的验证

在定义 TNumStr 之前，我们需要一种验证数字字符串的方法。

数字字符串包括：

- 整数。例如，"0"、"100"、"-10" 和 "+20"。

- 双精度数。例如，"0.1"、"-10.3"、"+3.14"、".05"、"1." 和 "0.0"。

我们需要注意 "0" 和 "0.0" 是不同的。因为它们的类型不同。"0" 的类型是整数，而 "0.0" 的类型是双精度数。同样地，"1" 是一个整数，而 "1." 是一个双精度数。

".5" 和 "0.5" 是相同的。它们都是双精度数，它们的值都是 0.5。

数字字符串的验证是一种词法分析的形式。通常在词法分析中会使用状态图和状态矩阵。

数字字符串是满足以下条件的字符序列：

1. '+' 或 '-' 可以是第一个字符。它也可以省略不写。

2. 紧接着是一系列数字。

3. 然后是一个点。

4. 最后是另一系列数字。

第二部分可以省略。例如，".56" 或 "-.56" 是正确的。

第三和第四部分也可以省略。例如，"12" 或 "-23" 是正确的。

第四部分也可以省略。例如，"100." 是正确的。

- 0 是起始点。

- 1 是 '+' 或 '-' 之后的状态。

- 2 是第一系列数字（整数部分）的中间状态。

- 3 是小数点之后的状态。

- 4 是字符串的结尾，且字符串是整数。

- 5 是字符串的结尾，且字符串是双精度数。

- 6 是错误状态。字符串不表示一个数字。

输入字符如下：

- 0：'+' 或 '-'

- 1：数字 ('0' - '9')

- 2：句点 '.'

- 3：字符串结束 '\0'

- 4：其他字符

状态图如下所示。

![](/assets/GObjectStudy/202311/08_GObject/state_diagram.png)

状态矩阵如下：

<table>
  <tr>
    <th style="width: 100px; text-align: center;">状态＼输入</th>
    <th style="width: 50px; text-align: center;">0</th>
    <th style="width: 50px; text-align: center;">1</th>
    <th style="width: 50px; text-align: center;">2</th>
    <th style="width: 50px; text-align: center;">3</th>
    <th style="width: 50px; text-align: center;">4</th>
  </tr>
  <tr>
    <td style="text-align: center;">0</td>
    <td style="text-align: center;">1</td>
    <td style="text-align: center;">2</td>
    <td style="text-align: center;">3</td>
    <td style="text-align: center;">6</td>
    <td style="text-align: center;">6</td>
  </tr>
  <tr>
    <td style="text-align: center;">1</td>
    <td style="text-align: center;">6</td>
    <td style="text-align: center;">2</td>
    <td style="text-align: center;">3</td>
    <td style="text-align: center;">6</td>
    <td style="text-align: center;">6</td>
  </tr>
  <tr>
    <td style="text-align: center;">2</td>
    <td style="text-align: center;">6</td>
    <td style="text-align: center;">2</td>
    <td style="text-align: center;">3</td>
    <td style="text-align: center;">4</td>
    <td style="text-align: center;">6</td>
  </tr>
  <tr>
    <td style="text-align: center;">3</td>
    <td style="text-align: center;">6</td>
    <td style="text-align: center;">3</td>
    <td style="text-align: center;">6</td>
    <td style="text-align: center;">5</td>
    <td style="text-align: center;">6</td>
  </tr>
</table>


这个状态图不支持 "1.23e5" 风格的双精度数（十进制浮点数）。如果支持，状态图将会更加复杂。（然而，这将是锻炼编程技能的好机会。）