---
layout: post
title: 十五、GObject继承对象的私有结构体
categories: GObject学习笔记
tags: [GObject]
---

## 1 如何定义带有私有结构体的实力对象

### 1.1 结构体名称（类型名+Private）

只需要在实例对象名称TypeName后面加(Private)

```c
/* 一定要是 TestObjectPrivate，因为 G_DECLARE_FINAL_TYPE 和 G_DECLARE_DERIVABLE_TYPE 没有 typedef struct _TestObjectPrivate TestObjectPrivate */
typedef struct _TestObjectPrivate TestObjectPrivate;
struct _TestObjectPrivate{
  int dummy_0;
  float dummy_1;
} TestObjectPrivate;
```

### 1.2 如何定义 

**方式一**：

```c
G_DEFINE_TYPE_WITH_CODE (TestObject, test_object, G_TYPE_OBJECT,
                         G_ADD_PRIVATE (TestObject))
```

**方式二**：

```c
G_DEFINE_TYPE_WITH_PRIVATE (TestObject, test_object, G_TYPE_OBJECT)
```



其实核心都是一样，都是调用 `g_type_add_instance_private`，然后把私有结构体的大小赋值给 `private_size`。

  ![alt text](/assets/GObjectStudy/202311/15_GObject/image/image.png)

对象被创建的时候，其实创建的大小等于 `instance_size + private_size`
  
  ![alt text](/assets/GObjectStudy/202311/15_GObject/image/image-1.png)


## 2 问题总结

### 2.1 私有结构体能否被继承

可以被继承，一般不能被访问到（除非定义到同一个源文件里面）。私有结构体一般被定义到源文件里面，还有获取私有结构体的 `类型_名称_get_instance_private（）`函数也是在源文件里面定义的。

![alt text](/assets/GObjectStudy/202311/15_GObject/image/image-2.png)
