---
layout: post
title: 三、qmake创建项目文件
categories: qmake
tags: [qmake]
---
项目文件（.pro）包含qmake构建应用程序、库或插件所需的所有信息。通常，您会使用一系列声明来指定项目中的资源，但简单的编程结构支持也使您能够描述不同平台和环境的不同构建过程。

## 1 项目文件元素

qmake使用的项目文件格式既可支持简单又可支持相当复杂的构建系统。简单的项目文件采用直接的声明式风格，定义标准变量来指示项目中使用的源文件和头文件。复杂的项目可能使用控制流结构来微调构建过程。

以下部分描述了项目文件中使用的不同类型的元素。

### 1.1 变量


在项目文件中，变量用于存储字符串列表。在最简单的项目中，这些变量告知qmake使用哪些配置选项，或提供构建过程中使用的文件名和路径。

qmake在每个项目文件中查找特定变量，并根据这些变量的内容决定应该写入Makefile的内容。例如，HEADERS和SOURCES变量中的值列表用来告知qmake项目文件同一目录下的头文件和源文件。

变量也可以内部用于存储临时值列表，现有的值列表可以被覆盖或用新值扩展。

以下代码段展示了如何将值列表分配给变量：

```qmake
HEADERS = mainwindow.h paintwidget.h
```

在项目文件中，变量中的值列表通过以下方式扩展:

```qmake
SOURCES = main.cpp mainwindow.cpp \
          paintwidget.cpp
CONFIG += console
```

注意：第一个赋值只包括与HEADERS变量同行指定的值。第二个赋值使用反斜杠（\）将SOURCES变量中的值分散在多行。

`CONFIG` 变量是qmake在生成Makefile时使用的另一个特殊变量，在“General Configuration”中有讨论。在上面的代码片段中，console被添加到CONFIG中已有值的列表中。

以下表格列出了一些常用变量及其内容。有关变量及其描述的完整列表，请参见“变量”。

可以通过在变量名前加上$$来读取变量的内容。这可以用来将一个变量的内容分配给另一个变量：

| 变量       | 内容                                         |
|------------|----------------------------------------------|
| CONFIG     | 项目的一般配置选项。                         |
| DESTDIR    | 可执行文件或二进制文件将被放置的目录。       |
| FORMS      | 用户界面编译器（uic）将处理的UI文件列表。    |
| HEADERS    | 构建项目时使用的头文件（.h文件）的文件名列表。|
| QT         | 项目中使用的Qt模块列表。                     |
| RESOURCES  | 最终项目中包含的资源（.qrc）文件列表。       |
| SOURCES    | 构建项目时使用的源代码文件列表。             |
| TEMPLATE   | 项目的模板。这决定了构建过程的输出类型。     |

```qmake
TEMP_SOURCES = $$SOURCES
```

`$$` 操作符被广泛用于内置函数，这些函数对字符串和值列表进行操作。

**空白字符**

通常，空白字符用于分隔变量赋值中的值。要指定包含空格的值，必须将这些值括在双引号中：
```
DEST = "Program Files"
```

带引号的文本将被视为变量所持有的值列表中的单个项。在定义 Windows 平台的 INCLUDEPATH 和 LIBS 变量时，尤其包含空格的路径也采用类似的方法：

win32:INCLUDEPATH += "C:/mylibs/extra headers"
unix:INCLUDEPATH += "/home/user/extra headers"

### 1.2 注释

您可以向项目文件添加注释。注释以 # 字符开头，并延续到同一行的末尾。例如：
```
# 注释通常从行的开头开始，但也可以跟随同一行上的其他内容。
```

要在变量赋值中包含 # 字符，必须使用内置的 LITERAL_HASH 变量的内容。
### 1.3 内置函数和控制流

qmake 提供了许多内置函数，以便处理变量的内容。在简单的项目文件中最常使用的函数是 include() 函数，它以文件名作为参数。给定文件的内容将包含在项目文件中，包含函数所用的位置。include 函数最常用于包含其他项目文件：
```
include(other.pro)
```
通过类似于编程语言中的 if 语句的作用域来提供对条件结构的支持：
```
win32 {
SOURCES += paintwidget_win.cpp
}
```
花括号内的赋值只有在条件为真时才会执行。在这种情况下，win32 配置选项必须已设置。这在 Windows 上会自动发生。打开花括号必须与条件位于同一行。
对变量进行更复杂的操作通常需要循环的内置函数，例如 find()、unique() 和 count()。这些函数以及许多其他函数用于操作字符串和路径、支持用户输入以及调用外部工具。有关使用这些函数的更多信息，请参阅 qmake 语言。有关所有函数及其描述的列表，请参阅替代函数和测试函数。

## 2 项目模板

TEMPLATE 变量用于定义将要构建的项目类型。如果在项目文件中未声明此变量，qmake 将假定应构建一个应用程序，并生成一个适当的 Makefile（或等效文件）。

以下表格总结了可用的项目类型，并描述了 qmake 会为每个项目生成的文件：

| 模板        | qmake 输出                                         |
|------------|----------------------------------------------|
||