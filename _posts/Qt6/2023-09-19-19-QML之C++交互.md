---
layout: post
title: 十九、QML——C++交互
categories: QML
tags: [QML]
---

`QML` 与 `C++` 混合编程就是使用 `QML` 高效便捷地构建 `UI`，而 `C++` 则用来实现业务逻辑和复杂算法。

## 1 QML访问C++

QML访问C++有两个方法：

1. Qt元对象系统中注册C++类，在QML中实例化、访问。

2. 在C++中实例化，并设置为QML上下文属性，在QML中直接使用。

## 2 C++访问QML

无论使用 `QQmlComponent`，还是使用 `QQmlApplicationEngine` 实例化创建 `QML` 界面，获取Item对象，有些对象的地址可以获取，有些不能获取。

![alt text](image.png)

通过以下代码，可以获取到 `chartView` 和 `rect` ：

```c++
int main(int argc, char *argv[])
{
    /* QtCharts 使用 Qt Graphics View Framework 进行绘制，因此 QApplication一定要被使用，而不是 QGuiApplication */
    QApplication app(argc, argv);

    QQmlApplicationEngine engine;

    /* 如果 engine 在加载 QML 文件时遇到任何问题，例如 QML 文件中有语法错误，或者无法加载所需的组件，那么会发射 objectCreationFailed 信号。 */
    QObject::connect(&engine, &QQmlApplicationEngine::objectCreationFailed,
                     &app, []() { QCoreApplication::exit(-1); },
    Qt::QueuedConnection);

    QQmlComponent component(&engine, QUrl(QStringLiteral("../../MyLineSeries.qml")));
    QObject *object = component.create();
    QObject *rect = object->findChild<QObject *>("rect");

    const QList<QObject*> children = object->children();
    for (QObject *child : children) {
        qDebug() << "顶层root下 Child:" << child->objectName();
    }


    return app.exec();
}
```

![alt text](image-1.png)


通过以下代码，并不能获取到可以获取到 `axisX` 和 `axisX` 和 `chartView` ：

```c++
int main(int argc, char *argv[])
{
    /* QtCharts 使用 Qt Graphics View Framework 进行绘制，因此 QApplication一定要被使用，而不是 QGuiApplication */
    QApplication app(argc, argv);

    QQmlApplicationEngine engine;

    /* 如果 engine 在加载 QML 文件时遇到任何问题，例如 QML 文件中有语法错误，或者无法加载所需的组件，那么会发射 objectCreationFailed 信号。 */
    QObject::connect(&engine, &QQmlApplicationEngine::objectCreationFailed,
                     &app, []() { QCoreApplication::exit(-1); },
    Qt::QueuedConnection);

    QQmlComponent component(&engine, QUrl(QStringLiteral("../../MyLineSeries.qml")));
    QObject *object = component.create(); /* 根对象 */
    QObject *chartView = object->findChild<QObject *>("chartView");

    const QList<QObject*> children = chartView->children();
    for (QObject *child : children) {
        qDebug() << "chartview下 Child:" << child->objectName();
    }


    return app.exec();
}
```

![alt text](image-2.png)

通过以下代码，并不能获取到可以获取到 `rect1` 和 `rect2` ：

```c++
int main(int argc, char *argv[])
{
    /* QtCharts 使用 Qt Graphics View Framework 进行绘制，因此 QApplication一定要被使用，而不是 QGuiApplication */
    QApplication app(argc, argv);

    QQmlApplicationEngine engine;

    /* 如果 engine 在加载 QML 文件时遇到任何问题，例如 QML 文件中有语法错误，或者无法加载所需的组件，那么会发射 objectCreationFailed 信号。 */
    QObject::connect(&engine, &QQmlApplicationEngine::objectCreationFailed,
                     &app, []() { QCoreApplication::exit(-1); },
    Qt::QueuedConnection);

    QQmlComponent component(&engine, QUrl(QStringLiteral("../../MyLineSeries.qml")));
    QObject *object = component.create(); /* 根对象 */
    QObject *rect = object->findChild<QObject *>("rect");

    const QList<QObject*> children = rect->children();
    for (QObject *child : children) {
        qDebug() << "rect下 Child:" << child->objectName();
    }


    return app.exec();
}
```

![alt text](image-3.png)

可以主要参考：https://www.nxrte.com/jishu/11158.html

参考：https://www.cnblogs.com/jzcn/p/17774676.html

https://blog.csdn.net/zwcslj/article/details/140618579

https://blog.csdn.net/sjp11/article/details/131617850

https://doc.qt.io/qt-6/qtcharts-qmlaxes-example.html

https://stuff.mit.edu/afs/athena/software/texmaker_v5.0.2/qt57/doc/qtcharts/qtcharts-qmlaxes-example.html